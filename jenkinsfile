pipeline {
 environment {
    		DOCKERHUB_CREDENTIALS=credentials('docker')
        SCANNER_HOME = tool 'sonar-scanner'
//when i want t oaccess the github secrets
 SONAR_HOST_URL = "${env.SONAR_HOST_URL}"
        SONARQUBE_LOGIN_TOKEN_JENKINS = "${env.SONARQUBE_LOGIN_TOKEN_JENKINS}"
    	}
    agent any
stages{

         stage("clean up")
{  steps{
       deleteDir()

}}
stage("chekout"){

  steps { git url: 'https://github.com/nourchawebi/astonvilla.git'}

}
stage("generate docker image")
{
steps { sh "docker build -t nourchawebi/astonvilla:1.1.${env.BUILD_NUMBER} ." }
}
stage ("login")
{
	steps {	sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'
	}
}
stage ("push")
{
steps{
 sh " docker push  nourchawebi/astonvilla:1.1.${env.BUILD_NUMBER}"
}

}
stage('SonarQube Analysis') {
            steps {
              
                    sh '''$SCANNER_HOME/bin/sonar-scanner \
                        -Dsonar.host.url=${SONAR_HOST_URL} \
                        -Dsonar.login=${SONAR_TOKEN_JENKINS} \
                        -Dsonar.projectName=astonvillaJenkins \
                        -Dsonar.java.binaries=. \
                        -Dsonar.projectKey=astonvillaJenkins '''
                
            }
        }
}}
// pipeline {
//     agent any
//     stages {
//         stage('Greeting') {
//             steps {
//                 sh 'echo "Hello we are creating a pipeline for astonvilla App!"'
//             }
//         }
//     }
// }

